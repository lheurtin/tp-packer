---
- hosts: all
  become: yes
  tasks:
    - name: Install package GIT
      package:
        name: git
        state: latest
    - name: Install package Golang
      package:
        name: golang
        state: latest
    - name: Install package Make
      package:
        name: make
        state: latest
    - name: Autoriser 8080 depuis l'extérieur
      ansible.posix.firewalld:
        zone: public
        port: 8080/tcp
        permanent: yes
        state: enabled
    - name: Clone golang-myip
      ansible.builtin.git:
        repo: https://github.com/BastienBalaud/golang-myip
        dest: /golang-myip
    - name: Utilisation de make pour compiler golang-myip
      ansible.builtin.shell:
       cmd: make
       chdir: /golang-myip
#    - name: Build all target with a custom Makefile
#      community.general.make:
#          chdir: /golang-myip
#          target: all
#          file: /golang-myip/Makefile
#    - name: Build server.go
#      shell: go build /golang-myip/server.go
#    - name: Launch server
#      shell: /golan-myip/server
#    - name: Se positionner dans le répertoire de mypip
#      shell: cd /repo/golang-myip/
#    - name: Build server.go
#      shell: ./server.go
    - name: Lancement du serveur myip
      ansible.builtin.shell:
        cmd: /golang-myip/server